---
title: 'Flickr example: Retrieve a Flickr gallery and display it on a web page'
permalink: /flickr-example/
categories:
- api-doc
tags: []
status: publish
type: notes_apis
published: true
date: January 15, 2015
---
<p>In this Flickr API example, you'll see that our goal requires us to call several endpoints. The point is that just having an API reference that lists the endpoints and responses isn't enough. Often one endpoint requires other endpoints, and so on.</p>
<p>Suppose we want to get all the photos from a <a href="https://www.flickr.com/photos/flickr/galleries/72157647277042064/">specific Flickr gallery</a> and display them on a web page. Here's the gallery we want:</p>
<p><a href="https://www.flickr.com/photos/flickr/galleries/72157647277042064/"><img src="/images/flickrgallery.png" alt="flickrgallery" width="550" height="293" class="alignnone size-full wp-image-22475" /></a></p>
<p>From the list of <a href="https://www.flickr.com/services/api/">Flickr's API methods</a>, the <a href="https://www.flickr.com/services/api/flickr.galleries.getPhotos.html">flickr.galleries.getPhotos</a> is the one that will get photos from a gallery.</p>
<p><a href="https://www.flickr.com/services/api/flickr.galleries.getPhotos.html"><img src="/images/flickr_get_photos.png" alt="flickr_get_photos" width="550" height="360" class="alignnone size-full wp-image-22476" /></a></p>
<p>You can see that each endpoint has some common sections:</p>
<ul>
<li>the endpoint</li>
<li>what it returns</li>
<li>authentication</li>
<li>arguments</li>
<li>example response</li>
<li>error codes</li>
<li>API Explorer</li>
</ul>
<p>One of the arguments we need is the gallery ID. Before we can use this endpoint, we have to use another endpoint to get the gallery ID, because (rather unintuitively) the gallery ID is <em>not</em> the ID that appears in the URL of the gallery.</p>
<p>We use the <a href="https://www.flickr.com/services/api/explore/flickr.urls.lookupGallery">flickr.urls.lookupGallery</a> endpoint to get the gallery ID from a gallery URL:</p>
<p><a href="https://www.flickr.com/services/api/explore/flickr.urls.lookupGallery"><img src="/images/flickr_gallery_id.png" alt="flickr_gallery_id" width="550" height="398" class="alignnone size-full wp-image-22477" /></a></p>
<p>The API Explorer makes the following call:</p>
<pre>
https://api.flickr.com/services/rest/?method=flickr.urls.lookupGallery&api_key={your api key}&url=https%3A%2F%2Fwww.flickr.com%2Fphotos%2Fflickr%2Fgalleries%2F72157647277042064%2F&format=json&nojsoncallback=1
</pre>
<p>If you send this request via your browser, you see:</p>
<p><a href="https://api.flickr.com/services/rest/?method=flickr.urls.lookupGallery&amp;api_key={your api key}&amp;url=https%3A%2F%2Fwww.flickr.com%2Fphotos%2Fflickr%2Fgalleries%2F72157647277042064%2F&amp;format=json&amp;nojsoncallback=1"><img src="/images/flickr_response.png" alt="flickr_response" width="550" height="384" class="alignnone size-full wp-image-22478" /></a></p>
<p>Note that I'm using the <a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en">JSON Formatting extension for Chrome</a> to make the JSON response more readable. Without this plugin, the JSON response is compressed.</p>
<p>(Also note that the API Explorer feature in the Flickr API docs includes a token in the request beyond the API key. However, I think this <a href="http://stackoverflow.com/questions/10657241/flickr-api-api-key-keeps-getting-invalid">token is temporary and expires</a>, so I omitted it here.)</p>
<p>The gallery ID is <code>66911286-72157647277042064</code>. We now have the arguments we need for the <a href="https://www.flickr.com/services/api/flickr.galleries.getPhotos.html">flickr.galleries.getPhotos</a> endpoint. If I go to the <a href="https://www.flickr.com/services/api/explore/flickr.galleries.getPhotos">API Explorer for this endpoint</a>, I can plug in the gallery ID.</p>
<p><a href="https://www.flickr.com/services/api/explore/flickr.galleries.getPhotos"><img src="/images/flickr_gallery_response.png" alt="flickr_gallery_response" width="550" height="259" class="alignnone size-full wp-image-22479" /></a></p>
<p>Flickr's API Explorer simplifies the process of adding arguments to the endpoint. I can see the response from my request in the API Explorer. Many APIs have an API Explorer tool that makes it easy to construct requests with the parameters configured correctly. However, I can also go to the endpoint auto-generated from the arguments I entered and see the response directly in the browser:</p>
<pre>
https://api.flickr.com/services/rest/?method=flickr.galleries.getPhotos&api_key={your api key}&gallery_id=66911286-72157647277042064&format=json&nojsoncallback=1
</pre>
<p>Here's the JSON response in the browser:</p>
<p><a href="https://api.flickr.com/services/rest/?method=flickr.galleries.getPhotos&amp;api_key=c962d7440cbbfd61785c0952cba8032e&amp;gallery_id=66911286-72157647277042064&amp;format=json&amp;nojsoncallback=1"><img src="/images/rawjsonflickr-550x460.png" alt="rawjsonflickr" width="550" height="460" class="alignnone size-medium wp-image-22480" /></a></p>
<p>All the necessary information is included in this response in order to display photos on our site, but it's not entirely intuitive how we construct the image source URLs from the response. Note that, once again, the information a user needs to actually achieve a goal isn't explicit in the API reference documentation. All the reference doc explains is what gets returned in the response, not how to actually use the response.</p>
<p>The <a href="https://www.flickr.com/services/api/misc.urls.html">Photo Source URLs</a> page in the documentation explains it:</p>
<blockquote><p>
You can construct the source URL to a photo once you know its ID, server ID, farm ID and secret, as returned by many API methods.</p>
<p>The URL takes the following format:</p>
<pre>https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg
    or
https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg
    or
https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{o-secret}_o.(jpg|gif|png)
</pre>
</blockquote>
<p>Here's what an item in the JSON response looks like:</p>
<pre>
"photos": {
  "page": 1,
  "pages": 1,
  "perpage": 500,
  "total": 15,
  "photo": [
    {
     "id": "8432423659",
     "owner": "37107167@N07",
     "secret": "dd1b834ec5",
     "server": "8187",
     "farm": 9,
     "title": "Color",
     "ispublic": 1,
     "isfriend": 0,
     "isfamily": 0,
     "is_primary": 1,
     "has_comment": 0
} ...
</pre>
<p>You access these fields through dot notation. It's a good idea to log the whole object to the console just to explore it better.</p>
<h2>Displaying the photos using jQuery</h2>
<p>The following code uses jQuery to loop through each of the responses and inserts the necessary components into an image tag to display each photo. Usually in documentation you don't need to be so explicit about how to use a common language like jQuery. You assume that the developer is capable in a specific language (just not with your API).</p>
<p>{% highlight html %}<br />
&lt;html&gt;<br />
&lt;style&gt;<br />
img {max-height:125px; margin:3px; border:1px solid #dedede;}<br />
&lt;/style&gt;<br />
&lt;body&gt;</p>
<p>&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js&quot;&gt;&lt;/script&gt;</p>
<p>&lt;script&gt;<br />
// get gallery payload<br />
     var url = &quot;https://api.flickr.com/services/rest/?method=flickr.galleries.getPhotos&amp;api_key={your api key}&amp;gallery_id=66911286-72157647277042064&amp;format=json&amp;nojsoncallback=1&quot;;<br />
    $.getJSON( url, function( data ) {<br />
// payload gets assigned to data argument, which is logged to console for inspection<br />
    	console.log(data);</p>
<p>// get title of gallery and append it to a tag on the page<br />
$(&quot;#galleryTitle&quot;).append(data.photos.photo[0].title + &quot; Gallery&quot;);</p>
<p>// loop through payload using jQuery each and insert necessary elements into image src url<br />
$.each( data.photos.photo, function( i, gp ) {</p>
<p>var farmId = gp.farm;<br />
var serverId = gp.server;<br />
var id = gp.id;<br />
var secret = gp.secret;</p>
<p>console.log(farmId + &quot;, &quot; + serverId + &quot;, &quot; + id + &quot;, &quot; + secret);</p>
<p>// here's the format we need to display the images:<br />
//  https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg</p>
<p>$(&quot;#flickr&quot;).append('&lt;img src=&quot;https://farm' + farmId + '.staticflickr.com/' + serverId + '/' + id + '_' + secret + '.jpg&quot;/&gt;');</p>
<p> });<br />
});</p>
<p>&lt;/script&gt;</p>
<p>&lt;h2&gt;&lt;div id=&quot;galleryTitle&quot;&gt;&lt;/div&gt;&lt;/h2&gt;<br />
&lt;div style=&quot;clear:both;&quot;/&gt;<br />
&lt;div id=&quot;flickr&quot;/&gt;</p>
<p>&lt;/body&gt;<br />
&lt;/html&gt;<br />
{% endhighlight %}</p>
<p>And the result looks like this:</p>
<p><a href="http://idratherbetellingstories.com/wp-content/apidemos/flickr.html"><img src="/images/flickrcolorgallerydemo-550x190.png" alt="flickrcolorgallerydemo" width="550" height="190" class="alignnone size-medium wp-image-22481" /></a></p>
<p>You can <a href="http://idratherbetellingstories.com/wp-content/apidemos/flickr.html">view the code here</a></p>
<h2>Code explanation</h2>
<p>In this code, the <a href="http://api.jquery.com/jquery.getjson/">getJSON</a> method from jQuery gets the JSON payload. The payload is assigned to the <code>data</code> argument and then logged to the console.</p>
<p>The data object contains an object called <code>photos</code>, which contains an array called <code>photo</code>. The <code>title</code> field is a property in the photo object. The <code>title</code> is accessed through this dot notation: <code>data.photos.photo[0].title</code>.</p>
<p>To get each item in the object, jQuery's <a href="http://api.jquery.com/jquery.each/">each method</a> loops through an object's properties.</p>
<p>By the way, the jQuery <code>each</code> method is commonly used for looping through results to get values. Here's how it works. For the first argument (<code>data.photos.photo</code>), you identify the object that you want to access.</p>
<p>For the <code>function( i, gp )</code> arguments, you list an index and value. You can use any names you want here. <code>gp</code> becomes a variable that refers to the <code>data.photos.photo</code> object you're looping through. <code>i</code> refers to the starting point through the object. (You don't actually need to refer to <code>i</code> beyond the mention here unless you want to begin the loop at a certain point.)</p>
<p>To access the properties in the JSON object, we use <code>gp.farm</code> instead of <code>data.photos.photo[0].farm</code>, because <code>gp</code> is an object reference to <code>data.photos.photo</code>.</p>
<p>After the <code>each</code> function iterates through the response, I added some variables make it easier to work with these components (using <code>serverId</code> instead of <code>gp.server</code>, etc.). And a <code>console.log</code> message checks to ensure we're getting values for each of the elements we need:</p>
<p>This comment shows where we need to plug in each of the variables:</p>
<p>{% highlight html %}//  https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg{% endhighlight %}</p>
<p>The final line shows how you insert those variables into the HTML:</p>
<p>{% highlight html %}$(&quot;#flickr&quot;).append('&lt;img src=&quot;https://farm' + farmId + '.staticflickr.com/' + serverId + '/' + id + '_' + secret + '.jpg&quot;/&gt;');{% endhighlight %}</p>
